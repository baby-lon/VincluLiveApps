<!doctype html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<title>Vinclu</title>
	<script type="text/javascript" src="js/jquery-1.11.1.min.js"></script>
	<script type="text/javascript" src="js/vincluled.js"></script>
	<script type="text/javascript" src="js/idol.js"></script>
	<script type="text/javascript" src="js/client_idol.js"></script>
	<script type="text/javascript">
		$(document).ready(function(){
			var accel_remain = 5;//規定値を超えても許容する更新回数
			var light_count = 0;
			vinclu_led = new VincluLed(100,100);
			vinclu_led.init();
			//読み込み完了時に行う処理
			$('#btnStart').click(function(event) {
				ws.send('start');
			});
			$('#btnStop').click(function(event) {
				ws.send('end');
			});
			window.addEventListener("devicemotion", function(event){

			    //加速度
			    var x = event.acceleration.x;
			    var y = event.acceleration.y;
			    var z = event.acceleration.z;


			    //傾き
			    var xg = event.accelerationIncludingGravity.x;
			    var yg = event.accelerationIncludingGravity.y;
			    var zg = event.accelerationIncludingGravity.z;

			    //回転値
			    var a = event.rotationRate.alpha; //z方向
			    var b = event.rotationRate.beta; //x方向
			    var g = event.rotationRate.gamma; // y方向

			    var txt  = "x:"+x+"<br>";
			        txt += "y:"+y+"<br>";
			        txt += "z:"+z+"<br>";

			        txt += "傾きx:"+xg+"<br>";
			        txt += "傾きy:"+yg+"<br>";
			        txt += "傾きz:"+zg+"<br>";

			        txt += "alpha(z):"+a+"<br>";
			        txt += "beta(x):"+b+"<br>";
			        txt += "gamma(y):"+g+"<br>";

			    console.log(txt);
			    $('#message_area').html(txt);

			    if(8.0 < Math.abs(y)){
			    	if(light_count <= 0){
			    		ws.send('start');
			    	}
				    light_count = accel_remain;
				}
				light_count--;
				if(light_count == 0){
					ws.send('end');
				}
			}, true);
		});
	</script>
</head>
<body>
   <input type='button' value='開始' id='btnStart' class='btn'>
   <input type='button' value='停止' id='btnStop' class='btn'>
   <div id="message_area"></div>
</body>
</html>