<!doctype html>
<html lang="ja">
<head>
  <title>ウィンクルLIVE</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="description" content="ウィンクルLIVE" />
  <meta name="keywords" content="ウィンクル, アプセサリー, ロマンチック, 鳥, ライブ" />
  <meta name="author" content="ウィンクル" />
  <meta name="copyright" content="Copyright (C) vinclu.me" />

  <!-- CSS -->    
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/vinclu_live_play.css" rel="stylesheet">
  <link href="css/style.css" rel="stylesheet" type="text/css">

  <!-- webフォント -->
  <link href='http://fonts.googleapis.com/css?family=Dancing+Script:400,700' rel='stylesheet' type='text/css'>

	<script type="text/javascript" src="js/jquery-1.11.1.min.js"></script>
	<script type="text/javascript" src="js/vincluled.js"></script>
	<script type="text/javascript" src="js/audience.js"></script>
	<script type="text/javascript">
	(function init_graph(){
			//↓これをwebsocketが来る前にやりたい
	    $('#graph_area').css({
	      height: '0px',
	      marginTop: (document.documentElement.clientHeight-70) + 'px'
	  	});
	})();
	</script>
	<script type="text/javascript" src="js/client.js"></script>
	<script type="text/javascript">
		$(document).ready(function(){
			vinclu_led = new VincluLed(100,100);
			vinclu_led.init();
			//読み込み完了時に行う処理
			$('#btnStart').click(function(){
				vinclu_led.on();
				vinclu_led.off();
			});
			is_init = true;

			var accel_remain = 5;//規定値を超えても許容する更新回数
			var light_count = 0;
		    var accel_threshold = 8.0;
		    var is_down = false;
		    var is_up = false;
		    var shake_count = 0;
		    var send_timing = 50;

			vinclu_led = new VincluLed(100,100);
			vinclu_led.init();
			//読み込み完了時に行う処理
			$('#btnShake').click(function(event) {
				ws.send('shake');
			});

			$('#btnStart').click(function(){
				vinclu_led.on();
				vinclu_led.off();
			});

			window.addEventListener("devicemotion", function(event){

			    //加速度
			    var x = event.acceleration.x;
			    var y = event.acceleration.y;
			    var z = event.acceleration.z;

			    if(accel_threshold < y){
			    	is_up = true;
			    	light_count = accel_remain;
				}
				if(y < accel_threshold * (-1.0)){
					is_down = true;
					light_count = accel_remain;
				}
				if(is_up == true && is_down == true){
					shake_count++;
				}
				if(shake_count % send_timing == send_timing -1){
					ws.send('shake');
				}

				light_count--;
				if(light_count == 0){
				    is_down = false;
				    is_up = false;
				}

			    /*var txt  = "x:"+x+"<br>";
			        txt += "y:"+y+"<br>";
			        txt += "z:"+z+"<br>";
			        txt += "shake:"+shake_count+"<br>";*/

			    //console.log(txt);
			    //$('#shake_area').html(txt);
			}, true);
		});
	</script>
</head>
<body>
   <div id="shake_area"></div>
  <div class="container text-center">
   <input type="button" value="開始" id="btnStart" class="btn">
   <div id="graph_area" class="graph"></div>
  </div>

</body>
</html>